---
layout: page
title: "Canonical Values Browser"
permalink: /value-browser/
---

<link rel="stylesheet" href="{{ '/assets/css/values.css' | relative_url }}">

<h1>Explore Canonical Values</h1>

<div id="filters" style="margin-bottom: 2rem;">
  <!-- All existing filters remain unchanged (NRBC, Core, Sector, Search, Sort) -->
  <!-- ... [same as before, unchanged filter block] ... -->

  <div style="margin-bottom: 2rem;">
    <button id="clearFiltersBtn">Clear All Filters</button>
    <button id="exportJsonBtn">Export JSON</button>
    <button id="exportCsvBtn">Export CSV</button>
  </div>
</div>

<!-- ðŸ§  Analytics Section -->
<div id="analytics" style="margin-bottom: 2rem; padding: 1rem; background: #f0f4f8; border-left: 4px solid #007acc;">
  <h2 style="margin-bottom: 0.5rem;">Analytics Summary</h2>
  <p><strong>Average Score:</strong> <span id="avgScore">â€“</span></p>
  <p><strong>Average Weight:</strong> <span id="avgWeight">â€“</span></p>
  <p><strong>NRBC Distribution:</strong></p>
  <ul id="nrbcCounts"></ul>
</div>

<div id="value-results"></div>

<script>
async function loadValues() {
  const response = await fetch('/assets/data/canonical-values.json');
  let values = await response.json();
  let filtered = [...values];

  const resultsContainer = document.getElementById('value-results');
  const searchBox = document.getElementById('searchBox');
  const sortSelect = document.getElementById('sortSelect');
  const avgScore = document.getElementById('avgScore');
  const avgWeight = document.getElementById('avgWeight');
  const nrbcCounts = document.getElementById('nrbcCounts');

  function render(data) {
    resultsContainer.innerHTML = '';
    if (data.length === 0) {
      resultsContainer.innerHTML = '<p>No matching values found.</p>';
      avgScore.textContent = 'â€“';
      avgWeight.textContent = 'â€“';
      nrbcCounts.innerHTML = '';
      return;
    }

    let totalScore = 0;
    let totalWeight = 0;
    const nrbcMap = {};

    data.forEach(val => {
      totalScore += val.score;
      totalWeight += val.weight;
      nrbcMap[val.nrbc] = (nrbcMap[val.nrbc] || 0) + 1;

      const card = document.createElement('div');
      card.className = 'value-card';
      card.innerHTML = `
        <h2>${val.title}</h2>
        <p><strong>NRBC:</strong> ${val.nrbc} | <strong>Core:</strong> ${val.core_values.join(', ')} | <strong>Sectors:</strong> ${val.sectors.join(', ')}</p>
        <p>${val.summary}</p>
        <p><strong>Score:</strong> ${val.score} | <strong>Weight:</strong> ${val.weight}</p>
        <div class="score-bar-container">
          <div class="score-bar" style="width: ${val.score * 45}%"></div>
        </div>
        <p><a href="${val.url}">Read More</a></p>
      `;
      resultsContainer.appendChild(card);
    });

    avgScore.textContent = (totalScore / data.length).toFixed(2);
    avgWeight.textContent = (totalWeight / data.length).toFixed(2);
    nrbcCounts.innerHTML = '';
    Object.keys(nrbcMap).sort().forEach(key => {
      const li = document.createElement('li');
      li.textContent = `${key}: ${nrbcMap[key]}`;
      nrbcCounts.appendChild(li);
    });
  }

  function applyFiltersAndSort() {
    const nrbcFilters = [...document.querySelectorAll('.nrbc-filter:checked')].map(cb => cb.value);
    const coreFilters = [...document.querySelectorAll('.core-filter:checked')].map(cb => cb.value);
    const sectorFilters = [...document.querySelectorAll('.sector-filter:checked')].map(cb => cb.value);
    const keyword = searchBox.value.toLowerCase().trim();

    filtered = values.filter(val => {
      const nrbcMatch = nrbcFilters.length === 0 || nrbcFilters.includes(val.nrbc);
      const coreMatch = coreFilters.length === 0 || coreFilters.some(tag => val.core_values.includes(tag));
      const sectorMatch = sectorFilters.length === 0 || sectorFilters.some(tag => val.sectors.includes(tag));
      const keywordMatch =
        keyword === '' ||
        val.title.toLowerCase().includes(keyword) ||
        val.summary.toLowerCase().includes(keyword) ||
        val.nrbc.toLowerCase().includes(keyword) ||
        val.core_values.some(cv => cv.toLowerCase().includes(keyword)) ||
        val.sectors.some(sc => sc.toLowerCase().includes(keyword));
      return nrbcMatch && coreMatch && sectorMatch && keywordMatch;
    });

    const sortOption = sortSelect.value;
    if (sortOption === 'score') {
      filtered.sort((a, b) => b.score - a.score);
    } else if (sortOption === 'weight') {
      filtered.sort((a, b) => b.weight - a.weight);
    } else if (sortOption === 'title') {
      filtered.sort((a, b) => a.title.localeCompare(b.title));
    }

    render(filtered);
  }

  document.querySelectorAll('.nrbc-filter, .core-filter, .sector-filter').forEach(cb => {
    cb.addEventListener('change', applyFiltersAndSort);
  });

  searchBox.addEventListener('input', applyFiltersAndSort);
  sortSelect.addEventListener('change', applyFiltersAndSort);

  document.getElementById('clearFiltersBtn').addEventListener('click', () => {
    document.querySelectorAll('.nrbc-filter, .core-filter, .sector-filter').forEach(cb => {
      cb.checked = false;
    });
    searchBox.value = '';
    sortSelect.value = 'default';
    applyFiltersAndSort();
  });

  document.getElementById('exportJsonBtn').addEventListener('click', () => {
    const blob = new Blob([JSON.stringify(filtered, null, 2)], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'canonical-values.json';
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
  });

  document.getElementById('exportCsvBtn').addEventListener('click', () => {
    const headers = Object.keys(filtered[0]).join(',');
    const rows = filtered.map(obj => Object.values(obj).map(v =>
      Array.isArray(v) ? `"${v.join('; ')}"` : `"${String(v).replace(/"/g, '""')}"`
    ).join(','));
    const csv = [headers, ...rows].join('\n');
    const blob = new Blob([csv], { type: 'text/csv' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'canonical-values.csv';
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
  });

  render(values);
}
document.addEventListener('DOMContentLoaded', loadValues);
</script>
